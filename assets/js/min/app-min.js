$(document).foundation(),$("a.close-risks").click(function(){$("#risks").foundation("reveal","close"),$(document).foundation({"magellan-expedition":{active_class:"active",threshold:120,destination_threshold:200,throttle_delay:50,fixed_top:0,offset_by_height:!0}})}),$(document).foundation("joyride","start"),$(".disabled-link").click(function(e){return e.preventDefault(),!1}),Highcharts.SparkLine=function(e,t){var a,i;return i={chart:{renderTo:e.chart&&e.chart.renderTo||this,backgroundColor:null,borderWidth:0,type:"area",margin:[0,0,0,0],padding:0,height:40,style:{overflow:"visible"},skipClone:!0,events:{click:function(){return e.chart_click()}},container:{onclick:null}},title:{text:""},credits:{enabled:!1},xAxis:{type:"datetime",minRange:36e5,labels:{enabled:!1},title:{text:null},startOnTick:!1,endOnTick:!1,tickPositions:[]},legend:{enabled:!1},tooltip:{enabled:!1},plotOptions:{series:{animation:!1,lineWidth:1,shadow:!1,states:{hover:{enabled:!1}},marker:{enabled:!1},fillOpacity:.25,point:{events:{click:function(){return e.chart_click()}}}}}},e=Highcharts.merge(i,e),a=new Highcharts.Chart(e,t)},angular.module("app",[]).factory("Api",["$http","$q",function(e,t){return{updateDEX:function(){var a=t.defer();return e.jsonp("https://api.bitsharesblocks.com/v2/cmc?callback=JSON_CALLBACK").success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},updateCMC:function(){var a=t.defer();return e.get("https://coinmarketcap-nexuist.rhcloud.com/api/bts").success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},priceHistory:function(a){var i=t.defer(),n=10,r="https://api.bitsharesblocks.com/v3/pricehistory/"+a+"/";return r+=JSON.stringify({days:n}),e.jsonp(r+"?callback=JSON_CALLBACK").success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}}]).directive("marketThumbnail",function(){return{template:'<div class="market-thumbnail">               <center><span class="spark-title">{{ title }}</span></center>               <div>                <span class="high"><label class="chart-label">H:</label> {{ market.high_price | number: 2 }}</span>                <span class="low"><label class="chart-label">L:</label> {{ market.min_price | number: 2 }}</span>                <span class="change pull-right" ng-class="{\'change-positive\':market.change >=0, \'change-negative\':market.change < 0}">                <span ng-if="market.change>0">+</span>{{ market.change | number: 2 }}%</span>               </div>               <div class="volume"><label class="chart-label">V:</label> {{market.volume | number : 0}} {{market.asset_base_symbol}}</div>               <div class="sparkchart"></div>               </div>',restrict:"E",replace:!0,scope:{name:"="},controller:function(e,t,a,i,n){var r,l,o;return r=function(){return console.log("clicked")},l={},l.quantity_symbol=e.name,l.base_symbol="BTS",l.asset_quantity_symbol=l.quantity_symbol.replace("Bit",""),l.asset_base_symbol=l.base_symbol.replace("Bit",""),l.price_symbol=""+l.base_symbol+"/"+l.quantity_symbol,l.inverse_price_symbol=""+l.quantity_symbol+"/"+l.base_symbol,e.title="Bit"+e.name+":BTS",n.priceHistory(l.quantity_symbol).then(function(a){var i,n;if(a){var o,c,s,u,m,p,h,d,b,v,_,f,y,k;if(!a||0===a.length)return;for(l.ohlc_data=[],l.volume_data=[],l.volume=0,l.last_price=0,l.max_volume=0,l.min_price=99999999,l.high_price=0,l.open=a.price[0][1],l.close=l.open,y=0,k=a.price.length;k>y;y++)v=a.price[y],_=v[0],h=v[1],l.last_price=c=v[4],p=v[3],u=v[2],s=p>u?p:u,m=u>p?p:u,h>s&&(s=h),c>s&&(s=c),m>h&&(m=h),m>c&&(m=c),d=(h+c)/2,s/d>1.25&&(s=1.1*Math.max(h,c)),d/m>1.25&&(m=.9*Math.min(h,c)),v.volume=a.volume[y],l.ohlc_data.push([_,d]),l.volume_data.push([v.volume[0],v.volume[1]]),l.volume+=v.volume[1],l.max_volume=Math.max(v.volume[1],l.max_volume),l.min_price=Math.min(d,l.min_price),l.high_price=Math.max(d,l.high_price),l.close=c;return l.max_volume=3*Math.floor(l.max_volume),l.change=(l.close-l.open)/l.open*100,e.market=l,o=l.change>0?"#28a92e":"#c90808",b=[{data:l.volume_data,pointStart:1,name:"Volume",type:"column",yAxis:1,dataGrouping:{enabled:!0},tooltip:{valueDecimals:0,valueSuffix:" BTS"}},{data:l.ohlc_data,pointStart:1,name:"Price",dataGrouping:{enabled:!0},tooltip:{valueDecimals:2,valueSuffix:" BTS/"+l.asset_quantity_symbol},min:l.min_price,color:o}],f=[{opposite:!0,labels:{enabled:!1},title:{text:null},gridLineWidth:0,min:.98*l.min_price},{endOnTick:!1,startOnTick:!1,labels:{enabled:!1},title:{text:null},gridLineWidth:0}],$(".sparkchart",t).highcharts("SparkLine",{series:b,yAxis:f,chart_click:r})}})}}}).controller("tickerCtrl",["$scope","$q","$interval","Api",function(e,t,a,i){function n(){t.all([i.updateDEX(),i.updateCMC()]).then(function(t){var a=t[0],i=t[1];e.price={},a.assets.forEach(function(t,a){if(r[t.symbol]){var n=i.price[t.symbol.toLowerCase()]?i.price[t.symbol.toLowerCase()]:i.price.usd,l=-1===t.symbol.indexOf("GOLD")?3:0;e.price[t.symbol]=(n/t.price).toFixed(l)+" "+r[t.symbol]+" / bit"+t.symbol}})})["catch"](function(e){console.log("dex error:",e)})}var r={USD:"$",CNY:"¥",GOLD:"$",BTC:"Ƀ",EUR:"€"};e.featured_markets=["USD","CNY","BTC","SILVER","GOLD","EUR"],n();var l=a(n,6e4);e.$on("$destroy",function(){a.cancel(l)})}]);